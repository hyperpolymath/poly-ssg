// SPDX-License-Identifier: MPL-2.0-or-later
= eclipse-ssg Design Specification
:toc:

== Summary

[cols="1,3"]
|===
|Name |eclipse-ssg
|Verdict |*ENGINE* (Priority: HIGH)
|Language |Pony
|Paradigm |Actor-model, reference capabilities
|===

== Rationale

=== Why ENGINE (High Priority)

Eclipse-ssg is one of the strongest candidates in the poly-ssg family:

1. **Unique concurrency model**: Pony's actor model provides lock-free, data-race-free parallelism. No other SSG offers this guarantee.

2. **Reference capabilities**: `val`, `iso`, `ref`, `tag` provide compile-time memory safety without garbage collection pauses.

3. **Production-ready toolchain**: Pony is actively maintained with good documentation and a growing community.

4. **Natural fit for SSG**: The actor model maps perfectly to SSG:
   - Watcher actor (file changes)
   - Parser actor (content processing)
   - Renderer actor (template application)
   - Emitter actor (file writing)

5. **Well-developed README**: This repo shows actual architecture and code examples. It's ahead of most others.

=== Paradigmatic Strength

[cols="1,2"]
|===
|SSG Concept |Pony Implementation

|Content files
|`val` (immutable, shareable across actors)

|Templates
|`val` (immutable, safe to share)

|Build process
|Actor message passing, automatic parallelism

|Configuration
|`val` records, validated at startup
|===

== Architecture (From README)

----
┌─────────────────────────────────────────────────────────┐
│                    Scheduler (Pony runtime)             │
├─────────────────────────────────────────────────────────┤
│  ┌──────────┐   ┌──────────┐   ┌──────────┐            │
│  │ Watcher  │──▶│  Parser  │──▶│ Renderer │            │
│  │  actor   │   │  actor   │   │  actor   │            │
│  └──────────┘   └──────────┘   └──────────┘            │
│                                      │                  │
│                               ┌──────▼──────┐          │
│                               │ FileEmitter │          │
│                               │   actor     │          │
│                               └─────────────┘          │
└─────────────────────────────────────────────────────────┘
----

== Reference Capability Usage

[cols="1,2,2"]
|===
|Capability |Meaning |SSG Use

|`val`
|Immutable, shareable
|Parsed content, templates, config

|`iso`
|Isolated, transferable
|Large buffers moving between actors

|`ref`
|Mutable, unique
|Builder state during construction

|`tag`
|Identity only
|Actor references
|===

== Implementation Roadmap

=== Phase 1: Core Actors (Mostly Complete?)
- [ ] Watcher actor with inotify bindings
- [ ] Parser actor with Markdown support
- [ ] Renderer actor with Mustache templates
- [ ] Emitter actor with file writing

=== Phase 2: Features
- [ ] Incremental builds via content hashing
- [ ] Hot reload via SSE
- [ ] Asset pipeline (CSS/JS processing)

=== Phase 3: MCP Integration
- [ ] C FFI wrapper for Pony
- [ ] ReScript adapter
- [ ] poly-ssg-mcp tool registration

== Estimated Effort

[cols="1,1"]
|===
|Phase |Time

|Core actors
|2 weeks

|Features
|2 weeks

|MCP integration
|1 week

|**Total**
|**5 weeks**
|===

== Priority Justification

Eclipse-ssg should be among the first engines completed because:
1. Pony expertise is rare; having a showcase project helps
2. The actor model is a genuinely novel approach to SSG
3. The README indicates substantial design work already done
